<!DOCTYPE html>
<html>
<head>
  <title>üîî Notifications</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f0f2f5;
    }
    h2 {
      color: #333;
    }
    .notification {
      background: #f9f9f9;
      border-left: 5px solid #007bff;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .unseen {
      background: #fffbe6;
      font-weight: bold;
    }
    button {
      margin-top: 8px;
      margin-right: 10px;
      padding: 4px 10px;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
    }
    button.delete {
      background: #dc3545;
    }
    #logoutBtn {
      float: right;
      background: #6c757d;
    }
  </style>
</head>
<body>

<h2>üîî Your Notifications
  <button id="logoutBtn" onclick="logout()">üö™ Logout</button>
</h2>

<div id="notificationList">Loading...</div>

<script>
  const token = localStorage.getItem("token");
  const container = document.getElementById("notificationList");

  // Redirect to login if no token
  if (!token) {
    alert("‚ùå Please log in first.");
    window.location.href = "/login.html"; // Update this path as per your structure
  } else {
    fetchNotifications();
  }

  // Logout function
  function logout() {
    localStorage.removeItem("token");
    alert("‚úÖ Logged out");
    location.href = "/login.html"; // Update this path if needed
  }

  // Fetch Notifications
  async function fetchNotifications() {
    try {
      const res = await fetch("http://localhost:5001/api/user/notifications", {
        headers: { Authorization: `Bearer ${token}` }
      });

      if (!res.ok) {
        const errorData = await res.json();
        throw new Error(errorData.message || "‚ùå Failed to fetch notifications.");
      }

      const data = await res.json();
      container.innerHTML = "";

      if (!Array.isArray(data) || data.length === 0) {
        container.innerHTML = "<p>‚úÖ No notifications yet.</p>";
        return;
      }

      data.forEach(n => {
        const div = document.createElement("div");
        div.className = "notification " + (n.seen ? "" : "unseen");
        div.innerHTML = `
          ${n.message}
          <br><small>${new Date(n.createdAt).toLocaleString()}</small>
          <div style="margin-top:5px;">
            ${!n.seen ? `<button onclick="markAsSeen('${n._id}')">‚úîÔ∏è Mark as seen</button>` : ""}
            <button class="delete" onclick="deleteNotification('${n._id}')">üóëÔ∏è Delete</button>
          </div>
        `;
        container.appendChild(div);
      });

    } catch (err) {
      console.error("‚ùå Notification fetch error:", err);
      container.innerHTML = `<p style="color:red;">${err.message}</p>`;
    }
  }

  // Mark notification as seen
  async function markAsSeen(id) {
    try {
      const res = await fetch(`http://localhost:5001/api/user/notifications/${id}/seen`, {
        method: "POST",
        headers: { Authorization: `Bearer ${token}` }
      });

      const data = await res.json();
      alert(data.message);
      fetchNotifications();
    } catch (err) {
      alert("‚ùå Failed to mark as seen.");
    }
  }

  // Delete notification
  async function deleteNotification(id) {
    try {
      const res = await fetch(`http://localhost:5001/api/user/notifications/${id}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
      });

      const data = await res.json();
      alert(data.message);
      fetchNotifications();
    } catch (err) {
      alert("‚ùå Failed to delete notification.");
    }
  }
</script>

</body>
</html>
